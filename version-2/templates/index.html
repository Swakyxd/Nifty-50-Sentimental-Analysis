<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NIFTY 50 Market Predictor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
        }

        .card-header h2 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .card-body {
            padding: 30px;
        }

        .input-section {
            margin-bottom: 30px;
        }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.1em;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1em;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        button {
            flex: 1;
            padding: 15px 30px;
            font-size: 1.1em;
            font-weight: 600;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .btn-predict {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-predict:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-clear {
            background: #6c757d;
        }

        .btn-clear:hover {
            background: #5a6268;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .result-section {
            display: none;
            margin-top: 30px;
        }

        .result-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .direction-badge {
            font-size: 1.5em;
            font-weight: bold;
            padding: 10px 25px;
            border-radius: 10px;
            display: inline-block;
        }

        .direction-up {
            background: #28a745;
            color: white;
        }

        .direction-down {
            background: #dc3545;
            color: white;
        }

        .confidence-badge {
            font-size: 1.3em;
            font-weight: 600;
            color: #667eea;
        }

        .result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .result-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .result-item label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .result-item .value {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
        }

        .signal-strong {
            color: #28a745;
        }

        .signal-moderate {
            color: #ffc107;
        }

        .signal-weak {
            color: #dc3545;
        }

        .info-section {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .info-section h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .info-label {
            color: #666;
            font-weight: 500;
        }

        .info-value {
            font-weight: 600;
            color: #333;
        }

        .error-message {
            display: none;
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #f5c6cb;
            margin-top: 20px;
        }

        .example-news {
            margin-top: 15px;
            padding: 15px;
            background: #e7f3ff;
            border-radius: 10px;
            border-left: 4px solid #2196F3;
        }

        .example-news h4 {
            color: #1976D2;
            margin-bottom: 10px;
        }

        .example-news p {
            color: #333;
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .example-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .example-btn:hover {
            background: #1976D2;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .card-body {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .result-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìà NIFTY 50 Market Predictor</h1>
            <p>AI-Powered Sentiment Analysis for Market Direction Prediction</p>
        </div>

        <div class="main-card">
            <div class="card-header">
                <h2>üîÆ Predict Market Movement</h2>
                <p>Enter financial news to predict NIFTY 50 market direction</p>
            </div>

            <div class="card-body">
                <div class="input-section">
                    <label for="newsInput">üì∞ Financial News Article:</label>
                    <textarea 
                        id="newsInput" 
                        rows="8" 
                        placeholder="Paste your financial news article here... (e.g., market analysis, company announcements, economic indicators)"
                    ></textarea>

                    <div class="example-news">
                        <h4>üí° Example News:</h4>
                        <p><strong>Positive Example:</strong> "NIFTY 50 hits record high as IT stocks surge. TCS, Infosys lead gains with strong quarterly earnings. Market sentiment remains bullish with FII inflows continuing."</p>
                        <button class="example-btn" onclick="loadExample(1)">Use This</button>
                        
                        <p style="margin-top: 10px;"><strong>Negative Example:</strong> "Markets plunge as inflation concerns mount. Banking stocks under pressure amid interest rate hike fears. Analysts warn of potential correction ahead."</p>
                        <button class="example-btn" onclick="loadExample(2)">Use This</button>
                    </div>

                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 10px; border-left: 4px solid #ffc107;">
                        <label style="margin-bottom: 10px;">üéØ Select Model Batch:</label>
                        <select id="batchSelect" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em;">
                            <option value="best_model">üèÜ Best Model (Batch 3: 2019-2021) - AUC: 78.27%</option>
                            <option value="batch_1">Batch 1 (2013-2015) - AUC: 74.52%</option>
                            <option value="batch_2">Batch 2 (2016-2018) - AUC: 66.80%</option>
                            <option value="batch_3">Batch 3 (2019-2021) - AUC: 78.27%</option>
                            <option value="batch_4">Batch 4 (2022-2024) - AUC: 60.69%</option>
                            <option value="batch_5">Batch 5 (2025) - AUC: N/A (Insufficient data)</option>
                        </select>
                        <p style="margin-top: 10px; font-size: 0.9em; color: #856404;">
                            üí° <strong>Tip:</strong> The best model (Batch 3) is pre-selected. You can try different batches to compare performance across different time periods.
                        </p>
                    </div>

                    <div class="button-group">
                        <button class="btn-predict" onclick="makePrediction()">
                            üöÄ Predict Market Direction
                        </button>
                        <button class="btn-predict" onclick="fetchLiveNews()" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            üì° Fetch Live News & Predict
                        </button>
                        <button class="btn-clear" onclick="clearAll()">
                            üóëÔ∏è Clear
                        </button>
                    </div>
                </div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Analyzing news and predicting market direction...</p>
                </div>

                <div class="error-message" id="errorMessage"></div>

                <div class="result-section" id="resultSection">
                    <div class="result-card">
                        <div class="result-header">
                            <div>
                                <span id="directionBadge" class="direction-badge">UP</span>
                            </div>
                            <div>
                                <span class="confidence-badge">Confidence: <span id="confidence">0%</span></span>
                            </div>
                        </div>

                        <div class="result-grid">
                            <div class="result-item">
                                <label>Current Price</label>
                                <div class="value" id="currentPrice">‚Çπ0.00</div>
                            </div>
                            <div class="result-item">
                                <label>Predicted Price</label>
                                <div class="value" id="predictedPrice">‚Çπ0.00</div>
                            </div>
                            <div class="result-item">
                                <label>Expected Change</label>
                                <div class="value" id="priceChange">0.00%</div>
                            </div>
                            <div class="result-item">
                                <label>Signal Strength</label>
                                <div class="value" id="signalStrength">MODERATE</div>
                            </div>
                        </div>
                    </div>

                    <div class="info-section">
                        <h3>üìä Sentiment Analysis</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">üòä Positive:</span>
                                <span class="info-value" id="sentimentPositive" style="color: #28a745;">0%</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">üòî Negative:</span>
                                <span class="info-value" id="sentimentNegative" style="color: #dc3545;">0%</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">üòê Neutral:</span>
                                <span class="info-value" id="sentimentNeutral" style="color: #6c757d;">0%</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">üìà Sentiment Score:</span>
                                <span class="info-value" id="sentimentScore">0.00</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">üéØ Confidence:</span>
                                <span class="info-value" id="sentimentConfidence">0%</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">üì∞ News Count:</span>
                                <span class="info-value" id="newsCount">0</span>
                            </div>
                        </div>
                        <div style="margin-top: 15px; padding: 15px; background: #e7f3ff; border-radius: 8px;">
                            <div style="font-size: 0.9em; color: #1976D2;">
                                <strong>üìä Sentiment Breakdown:</strong>
                                <div id="sentimentBar" style="margin-top: 10px; height: 30px; border-radius: 15px; overflow: hidden; display: flex; background: #e0e0e0;">
                                    <div id="positiveBar" style="background: #28a745; transition: width 0.5s;"></div>
                                    <div id="negativeBar" style="background: #dc3545; transition: width 0.5s;"></div>
                                    <div id="neutralBar" style="background: #6c757d; transition: width 0.5s;"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="info-section">
                        <h3>üß† Model Information</h3>
                        <div class="info-grid">
                            <div class="info-item">
                                <span class="info-label">Model Type:</span>
                                <span class="info-value">Enhanced Attention-LSTM</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Validation AUC:</span>
                                <span class="info-value" id="validationAUC">0%</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Data Source:</span>
                                <span class="info-value" id="priceSource">N/A</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Prediction Time:</span>
                                <span class="info-value" id="timestamp">N/A</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Live News Results Section -->
                <div class="result-section" id="liveNewsSection" style="display: none;">
                    <div class="info-section">
                        <h3>üì∞ Live Financial News - Predictions</h3>
                        <div id="liveNewsSummary" class="info-grid" style="margin-bottom: 20px;"></div>
                        <div id="aggregatePrediction" class="result-card" style="display: none; margin-bottom: 20px;"></div>
                        <div id="liveNewsResults"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function loadExample(num) {
            const newsInput = document.getElementById('newsInput');
            if (num === 1) {
                newsInput.value = "NIFTY 50 hits record high as IT stocks surge. TCS, Infosys lead gains with strong quarterly earnings. Market sentiment remains bullish with FII inflows continuing. Technology sector outperforms broader market indices.";
            } else if (num === 2) {
                newsInput.value = "Markets plunge as inflation concerns mount. Banking stocks under pressure amid interest rate hike fears. Analysts warn of potential correction ahead. Selling pressure intensifies across all sectors.";
            }
        }

        async function makePrediction() {
            const newsInput = document.getElementById('newsInput');
            const newsText = newsInput.value.trim();
            const batchSelect = document.getElementById('batchSelect');
            const selectedBatch = batchSelect.value;

            // Validation
            if (newsText.length < 10) {
                showError('Please enter at least 10 characters of news text');
                return;
            }

            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('liveNewsSection').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.querySelector('.btn-predict').disabled = true;

            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        news: newsText,
                        batch: selectedBatch
                    })
                });

                const data = await response.json();

                if (data.success) {
                    displayResults(data);
                } else {
                    showError(data.error || 'Prediction failed');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.querySelector('.btn-predict').disabled = false;
            }
        }

        function displayResults(data) {
            const pred = data.prediction;
            
            // Direction badge
            const directionBadge = document.getElementById('directionBadge');
            directionBadge.textContent = pred.direction;
            directionBadge.className = 'direction-badge direction-' + pred.direction.toLowerCase();

            // Main values
            document.getElementById('confidence').textContent = pred.confidence;
            document.getElementById('currentPrice').textContent = pred.current_price;
            document.getElementById('predictedPrice').textContent = pred.predicted_price;
            document.getElementById('priceChange').textContent = pred.price_change;
            
            // Signal strength with color
            const signalElement = document.getElementById('signalStrength');
            signalElement.textContent = pred.signal_strength;
            signalElement.className = 'value signal-' + pred.signal_strength.toLowerCase();

            // Sentiment analysis
            const sentimentPositive = (data.sentiment_analysis.sentiment_positive * 100).toFixed(1);
            const sentimentNegative = (data.sentiment_analysis.sentiment_negative * 100).toFixed(1);
            const sentimentNeutral = (data.sentiment_analysis.sentiment_neutral * 100).toFixed(1);
            
            document.getElementById('sentimentPositive').textContent = sentimentPositive + '%';
            document.getElementById('sentimentNegative').textContent = sentimentNegative + '%';
            document.getElementById('sentimentNeutral').textContent = sentimentNeutral + '%';
            
            const sentimentScore = data.sentiment_analysis.sentiment_score;
            const scoreElement = document.getElementById('sentimentScore');
            scoreElement.textContent = sentimentScore.toFixed(2);
            scoreElement.style.color = sentimentScore > 0 ? '#28a745' : sentimentScore < 0 ? '#dc3545' : '#6c757d';
            
            const sentimentConfidence = (data.sentiment_analysis.sentiment_confidence * 100).toFixed(1);
            document.getElementById('sentimentConfidence').textContent = sentimentConfidence + '%';
            document.getElementById('newsCount').textContent = data.sentiment_analysis.news_count;

            // Update sentiment bar
            document.getElementById('positiveBar').style.width = sentimentPositive + '%';
            document.getElementById('negativeBar').style.width = sentimentNegative + '%';
            document.getElementById('neutralBar').style.width = sentimentNeutral + '%';

            // Model info
            document.getElementById('validationAUC').textContent = data.model_info.validation_auc;
            document.getElementById('priceSource').textContent = pred.price_source;
            document.getElementById('timestamp').textContent = data.timestamp;

            // Show results
            document.getElementById('resultSection').style.display = 'block';
            
            // Smooth scroll to results
            document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = '‚ùå ' + message;
            errorDiv.style.display = 'block';
        }

        function clearAll() {
            document.getElementById('newsInput').value = '';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
        }

        async function fetchLiveNews() {
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('liveNewsSection').style.display = 'none';
            document.getElementById('resultSection').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            document.querySelector('.btn-predict').disabled = true;

            try {
                const response = await fetch('/predict-from-live-news', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        max_articles: 5,
                        hours_back: 12
                    })
                });

                const data = await response.json();

                if (data.success) {
                    displayLiveNewsResults(data);
                } else {
                    showError(data.error || 'Failed to fetch live news');
                }
            } catch (error) {
                showError('Network error: ' + error.message);
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.querySelector('.btn-predict').disabled = false;
            }
        }

        function displayLiveNewsResults(data) {
            const liveNewsSection = document.getElementById('liveNewsSection');
            const summaryDiv = document.getElementById('liveNewsSummary');
            const aggregateDiv = document.getElementById('aggregatePrediction');
            const resultsDiv = document.getElementById('liveNewsResults');

            // Display summary
            const summary = data.news_summary;
            summaryDiv.innerHTML = `
                <div class="info-item">
                    <span class="info-label">Total Articles:</span>
                    <span class="info-value">${summary.total_articles}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Sources:</span>
                    <span class="info-value">${summary.sources.length}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Latest:</span>
                    <span class="info-value">${new Date(summary.latest).toLocaleString()}</span>
                </div>
            `;

            // Display aggregate prediction
            if (data.aggregate_prediction) {
                const agg = data.aggregate_prediction;
                const aggColor = agg.direction === 'UP' ? '#28a745' : '#dc3545';
                aggregateDiv.innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <h3 style="color: ${aggColor}; font-size: 2em; margin-bottom: 10px;">
                            üìä Overall Market Sentiment: ${agg.direction}
                        </h3>
                        <p style="font-size: 1.3em; color: #666;">
                            Confidence: <strong>${agg.confidence}</strong> | 
                            UP Articles: <strong style="color: #28a745;">${agg.up_count}</strong> | 
                            DOWN Articles: <strong style="color: #dc3545;">${agg.down_count}</strong>
                        </p>
                        <p style="margin-top: 10px; color: #666;">
                            Average Confidence: ${agg.avg_confidence}
                        </p>
                    </div>
                `;
                aggregateDiv.style.display = 'block';
            }

            // Display individual predictions
            let resultsHTML = '<div style="display: grid; gap: 20px;">';
            
            data.individual_predictions.forEach(pred => {
                const directionColor = pred.prediction.direction === 'UP' ? '#28a745' : '#dc3545';
                const signalClass = pred.prediction.signal_strength.toLowerCase();
                
                resultsHTML += `
                    <div class="result-card" style="background: white; border-left: 5px solid ${directionColor};">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <h4 style="color: #333; margin-bottom: 10px; font-size: 1.1em;">
                                    ${pred.article_index}. ${pred.title}
                                </h4>
                                <p style="color: #666; font-size: 0.9em; margin-bottom: 5px;">
                                    <strong>Source:</strong> ${pred.source} | 
                                    <strong>Published:</strong> ${new Date(pred.published_at).toLocaleString()}
                                </p>
                                <a href="${pred.url}" target="_blank" style="color: #667eea; font-size: 0.9em;">
                                    Read full article ‚Üí
                                </a>
                            </div>
                            <div style="text-align: right; margin-left: 20px;">
                                <div style="background: ${directionColor}; color: white; padding: 10px 20px; border-radius: 8px; font-weight: bold; font-size: 1.2em; margin-bottom: 10px;">
                                    ${pred.prediction.direction}
                                </div>
                                <div style="color: #666; font-size: 0.9em;">
                                    Confidence: <strong>${pred.prediction.confidence}</strong>
                                </div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                            <div>
                                <div style="color: #666; font-size: 0.85em;">Predicted Price</div>
                                <div style="font-weight: bold; color: #333;">${pred.prediction.predicted_price}</div>
                            </div>
                            <div>
                                <div style="color: #666; font-size: 0.85em;">Price Change</div>
                                <div style="font-weight: bold; color: ${directionColor};">${pred.prediction.price_change}</div>
                            </div>
                            <div>
                                <div style="color: #666; font-size: 0.85em;">Signal Strength</div>
                                <div style="font-weight: bold;" class="signal-${signalClass}">${pred.prediction.signal_strength}</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            resultsHTML += '</div>';
            resultsDiv.innerHTML = resultsHTML;

            // Show section
            liveNewsSection.style.display = 'block';
            liveNewsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Allow Enter key to submit (Ctrl+Enter)
        document.getElementById('newsInput').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                makePrediction();
            }
        });
    </script>
</body>
</html>
